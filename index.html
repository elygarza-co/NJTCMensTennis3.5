<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>NJTC Men's Tennis 3.5</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/6.1.8/index.global.min.css" rel="stylesheet"/>
<style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar {
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .navbar-brand {
            font-weight: bold;
            font-size: 1.5rem;
        }
        
        .main-container {
            display: flex;
            min-height: calc(100vh - 76px);
        }
        
        .content-area {
            flex: 1;
            padding: 20px;
            margin-right: 350px; /* Make space for calendar */
        }
        
        .calendar-panel {
            position: fixed;
            right: 0;
            top: 76px; /* Below navbar */
            width: 340px;
            height: calc(100vh - 76px);
            background: white;
            border-left: 1px solid #dee2e6;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            overflow-y: auto;
            z-index: 1000;
        }
        
        .calendar-header {
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .calendar-content {
            padding: 15px;
        }
        
        .card {
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .card-header {
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            font-weight: bold;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 500;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #1e3a21 0%, #3a6b47 100%);
            transform: translateY(-1px);
        }
        
        .nav-pills .nav-link {
            border-radius: 8px;
            margin: 0 5px;
            font-weight: 500;
        }
        
        .nav-pills .nav-link.active {
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
        }
        
        .table {
            border-radius: 10px;
            overflow: hidden;
        }
        
        .table thead th {
            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
            color: white;
            border: none;
            font-weight: 600;
        }
        
        .match-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #4a7c59;
        }
        
        .match-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .status-scheduled {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-completed {
            background-color: #d1edff;
            color: #0c5460;
        }
        
        .status-cancelled {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .auth-container {
            max-width: 400px;
            margin: 50px auto;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .form-control {
            border-radius: 8px;
            border: 2px solid #e9ecef;
            padding: 12px 15px;
        }
        
        .form-control:focus {
            border-color: #4a7c59;
            box-shadow: 0 0 0 0.2rem rgba(74, 124, 89, 0.25);
        }
        
        .alert {
            border-radius: 8px;
            border: none;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner-border {
            color: #4a7c59;
        }
        
        /* Calendar customization */
        .fc {
            font-size: 0.85rem;
        }
        
        .fc-event {
            background-color: #4a7c59;
            border-color: #2c5530;
        }
        
        .fc-daygrid-event {
            border-radius: 4px;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .calendar-panel {
                display: none;
            }
            
            .content-area {
                margin-right: 0;
            }
            
            .main-container {
                flex-direction: column;
            }
        }
        
        /* Hide sections initially */
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
        }
    </style>
</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark">
<div class="container-fluid">
<a class="navbar-brand" href="#">
<i class="fas fa-tennis-ball me-2"></i>
                NJTC Men's Tennis 3.5
            </a>
<div class="navbar-nav ms-auto" id="navbarNav">
<div class="nav-item dropdown" id="userDropdown" style="display: none;">
<a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button">
<i class="fas fa-user me-1"></i>
<span id="userDisplayName">User</span>
</a>
<ul class="dropdown-menu">
<li><a class="dropdown-item" href="#" onclick="showProfile()">
<i class="fas fa-user-circle me-2"></i>Profile
                        </a></li>
<li><hr class="dropdown-divider"/></li>
<li><a class="dropdown-item" href="#" onclick="signOut()">
<i class="fas fa-sign-out-alt me-2"></i>Sign Out
                        </a></li>
</ul>
</div>
</div>
</div>
</nav>
<!-- Main Container -->
<div class="main-container">
<!-- Content Area -->
<div class="content-area">
<!-- Authentication Section -->
<div class="content-section active" id="authSection">
<div class="auth-container">
<div class="text-center mb-4">
<i class="fas fa-tennis-ball fa-3x text-success mb-3"></i>
<h2>Welcome to NJTC</h2>
<p class="text-muted">Men's Tennis 3.5 League</p>
</div>
<!-- Login Form -->
<div id="loginForm">
<h4 class="mb-3">Sign In</h4>
<form onsubmit="signIn(event)">
<div class="mb-3">
<label class="form-label" for="loginEmail">Email</label>
<input class="form-control" id="loginEmail" required="" type="email"/>
</div>
<div class="mb-3">
<label class="form-label" for="loginPassword">Password</label>
<input class="form-control" id="loginPassword" required="" type="password"/>
</div>
<button class="btn btn-primary w-100 mb-3" type="submit">
<i class="fas fa-sign-in-alt me-2"></i>Sign In
                            </button>
</form>
<div class="text-center">
<a class="text-decoration-none" href="#" onclick="showRegisterForm()">
                                Don't have an account? Register here
                            </a>
</div>
</div>
<!-- Register Form -->
<div id="registerForm" style="display: none;">
<h4 class="mb-3">Create Account</h4>
<form onsubmit="register(event)">
<div class="mb-3">
<label class="form-label" for="registerName">Full Name</label>
<input class="form-control" id="registerName" required="" type="text"/>
</div>
<div class="mb-3">
<label class="form-label" for="registerEmail">Email</label>
<input class="form-control" id="registerEmail" required="" type="email"/>
</div>
<div class="mb-3">
<label class="form-label" for="registerPassword">Password</label>
<input class="form-control" id="registerPassword" minlength="6" required="" type="password"/>
</div>
<div class="mb-3">
<label class="form-label" for="registerPhone">Phone Number</label>
<input class="form-control" id="registerPhone" type="tel"/>
</div>
<button class="btn btn-primary w-100 mb-3" type="submit">
<i class="fas fa-user-plus me-2"></i>Create Account
                            </button>
</form>
<div class="text-center">
<a class="text-decoration-none" href="#" onclick="showLoginForm()">
                                Already have an account? Sign in here
                            </a>
</div>
</div>
<div class="mt-3" id="authMessage"></div>
<div class="loading" id="authLoading">
<div class="spinner-border" role="status">
<span class="visually-hidden">Loading...</span>
</div>
</div>
</div>
</div>
<!-- Main App Section -->
<div class="content-section" id="appSection">
<!-- Navigation Tabs -->
<ul class="nav nav-pills mb-4" id="mainTabs">
<li class="nav-item">
<a class="nav-link active" href="#" onclick="showTab('dashboard')">
<i class="fas fa-tachometer-alt me-2"></i>Dashboard
                        </a>
</li>
<li class="nav-item">
<a class="nav-link" href="#" onclick="showTab('matches')">
<i class="fas fa-tennis-ball me-2"></i>Matches
                        </a>
</li>
<li class="nav-item">
<a class="nav-link" href="#" onclick="showTab('players')">
<i class="fas fa-users me-2"></i>Players
                        </a>
</li>
<li class="nav-item">
<a class="nav-link" href="#" onclick="showTab('tournaments')">
<i class="fas fa-trophy me-2"></i>Tournaments
                        </a>
</li>
<li class="nav-item">
<a class="nav-link" href="#" onclick="showTab('rankings')">
<i class="fas fa-chart-line me-2"></i>Rankings
                        </a>
</li>
</ul>
<!-- Dashboard Tab -->
<div class="tab-content active" id="dashboardTab">
<div class="row">
<div class="col-md-6">
<div class="card">
<div class="card-header">
<i class="fas fa-calendar-check me-2"></i>Upcoming Matches
                                </div>
<div class="card-body" id="upcomingMatches">
<div class="text-center text-muted">
<i class="fas fa-calendar-plus fa-2x mb-2"></i>
<p>No upcoming matches</p>
</div>
</div>
</div>
</div>
<div class="col-md-6">
<div class="card">
<div class="card-header">
<i class="fas fa-chart-bar me-2"></i>Quick Stats
                                </div>
<div class="card-body" id="quickStats">
<div class="row text-center">
<div class="col-4">
<h4 class="text-success" id="totalMatches">0</h4>
<small class="text-muted">Total Matches</small>
</div>
<div class="col-4">
<h4 class="text-primary" id="winRate">0%</h4>
<small class="text-muted">Win Rate</small>
</div>
<div class="col-4">
<h4 class="text-warning" id="currentRating">3.5</h4>
<small class="text-muted">Rating</small>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- Matches Tab -->
<div class="tab-content" id="matchesTab">
<div class="d-flex justify-content-between align-items-center mb-4">
<h3><i class="fas fa-tennis-ball me-2"></i>Matches</h3>
<button class="btn btn-primary" onclick="showScheduleMatchModal()">
<i class="fas fa-plus me-2"></i>Schedule Match
                        </button>
</div>
<div class="card">
<div class="card-body">
<div id="matchesList">
<div class="text-center text-muted">
<i class="fas fa-tennis-ball fa-2x mb-2"></i>
<p>No matches found</p>
</div>
</div>
</div>
</div>
</div>
<!-- Players Tab -->
<div class="tab-content" id="playersTab">
<div class="d-flex justify-content-between align-items-center mb-4">
<h3><i class="fas fa-users me-2"></i>Players</h3>
<div class="input-group" style="max-width: 300px;">
<input class="form-control" id="playerSearch" placeholder="Search players..." type="text"/>
<button class="btn btn-outline-secondary" onclick="searchPlayers()">
<i class="fas fa-search"></i>
</button>
</div>
</div>
<div class="card">
<div class="card-body">
<div class="table-responsive">
<table class="table table-hover">
<thead>
<tr>
<th>Name</th>
<th>Rating</th>
<th>Matches Played</th>
<th>Win Rate</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="playersTableBody">
<tr>
<td class="text-center text-muted" colspan="5">
<i class="fas fa-users fa-2x mb-2"></i>
<br/>Loading players...
                                            </td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<!-- Tournaments Tab -->
<div class="tab-content" id="tournamentsTab">
<div class="d-flex justify-content-between align-items-center mb-4">
<h3><i class="fas fa-trophy me-2"></i>Tournaments</h3>
</div>
<div class="row" id="tournamentsList">
<div class="col-12 text-center text-muted">
<i class="fas fa-trophy fa-2x mb-2"></i>
<p>No tournaments available</p>
</div>
</div>
</div>
<!-- Rankings Tab -->
<div class="tab-content" id="rankingsTab">
<div class="d-flex justify-content-between align-items-center mb-4">
<h3><i class="fas fa-chart-line me-2"></i>Rankings</h3>
</div>
<div class="card">
<div class="card-body">
<div class="table-responsive">
<table class="table table-hover">
<thead>
<tr>
<th>Rank</th>
<th>Player</th>
<th>Rating</th>
<th>Matches</th>
<th>Win Rate</th>
<th>Points</th>
</tr>
</thead>
<tbody id="rankingsTableBody">
<tr>
<td class="text-center text-muted" colspan="6">
<i class="fas fa-chart-line fa-2x mb-2"></i>
<br/>Loading rankings...
                                            </td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- Calendar Panel (Always Visible) -->
<div class="calendar-panel">
<div class="calendar-header">
<i class="fas fa-calendar-alt me-2"></i>
                Match Calendar
            </div>
<div class="calendar-content">
<div id="calendar"></div>
</div>
</div>
</div>
<!-- Schedule Match Modal -->
<div class="modal fade" id="scheduleMatchModal" tabindex="-1">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">
<i class="fas fa-tennis-ball me-2"></i>Schedule Match
                    </h5>
<button class="btn-close" data-bs-dismiss="modal" type="button"></button>
</div>
<div class="modal-body">
<form id="scheduleMatchForm">
<div class="mb-3">
<label class="form-label" for="opponentSelect">Opponent</label>
<select class="form-select" id="opponentSelect" required="">
<option value="">Select opponent...</option>
</select>
</div>
<div class="mb-3">
<label class="form-label" for="matchDate">Date &amp; Time</label>
<input class="form-control" id="matchDate" required="" type="datetime-local"/>
</div>
<div class="mb-3">
<label class="form-label" for="courtSelect">Court</label>
<select class="form-select" id="courtSelect" required="">
<option value="">Select court...</option>
<option value="Court 1">Court 1</option>
<option value="Court 2">Court 2</option>
<option value="Court 3">Court 3</option>
<option value="Court 4">Court 4</option>
</select>
</div>
<div class="mb-3">
<label class="form-label" for="matchNotes">Notes (Optional)</label>
<textarea class="form-control" id="matchNotes" rows="3"></textarea>
</div>
</form>
</div>
<div class="modal-footer">
<button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Cancel</button>
<button class="btn btn-primary" onclick="scheduleMatch()" type="button">
<i class="fas fa-calendar-plus me-2"></i>Schedule Match
                    </button>
</div>
</div>
</div>
</div>
<!-- Scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/6.1.8/index.global.min.js"></script>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
<script>
        // Firebase configuration - UPDATE WITH YOUR ACTUAL CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyBqJNXRt_AiGcpNkNKtpZ5cOQFQMQFQMQF",
            authDomain: "njtcmenstennis35.firebaseapp.com", 
            projectId: "njtcmenstennis35",
            storageBucket: "njtcmenstennis35.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef123456789012345"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Global variables
        let currentUser = null;
        let calendar = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeCalendar();
            
            // Monitor auth state
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    showApp();
                    loadUserData();
                    loadMatches();
                    loadPlayers();
                    loadTournaments();
                    loadRankings();
                } else {
                    currentUser = null;
                    showAuth();
                }
            });
        });

        // Authentication Functions
        function showLoginForm() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
            clearAuthMessage();
        }

        function showRegisterForm() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
            clearAuthMessage();
        }

        function showAuth() {
            document.getElementById('authSection').classList.add('active');
            document.getElementById('appSection').classList.remove('active');
            document.getElementById('userDropdown').style.display = 'none';
        }

        function showApp() {
            document.getElementById('authSection').classList.remove('active');
            document.getElementById('appSection').classList.add('active');
            document.getElementById('userDropdown').style.display = 'block';
            document.getElementById('userDisplayName').textContent = currentUser.displayName || currentUser.email;
        }

        async function signIn(event) {
            event.preventDefault();
            showLoading(true);
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                showAuthMessage('Sign in successful!', 'success');
            } catch (error) {
                showAuthMessage(getErrorMessage(error), 'danger');
            }
            
            showLoading(false);
        }

        async function register(event) {
            event.preventDefault();
            showLoading(true);
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const phone = document.getElementById('registerPhone').value;
            
            try {
                // Create user account
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Update profile
                await user.updateProfile({
                    displayName: name
                });
                
                // Create user document in Firestore
                await db.collection('users').doc(user.uid).set({
                    name: name,
                    email: email,
                    phone: phone,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    role: 'player' // Removed admin option as requested
                });
                
                // Create player profile
                await db.collection('players').doc(user.uid).set({
                    name: name,
                    email: email,
                    phone: phone,
                    rating: 3.5,
                    matchesPlayed: 0,
                    matchesWon: 0,
                    joinDate: firebase.firestore.FieldValue.serverTimestamp(),
                    active: true
                });
                
                showAuthMessage('Account created successfully!', 'success');
            } catch (error) {
                showAuthMessage(getErrorMessage(error), 'danger');
            }
            
            showLoading(false);
        }

        async function signOut() {
            try {
                await auth.signOut();
                showAuthMessage('Signed out successfully', 'info');
            } catch (error) {
                showAuthMessage(getErrorMessage(error), 'danger');
            }
        }

        // UI Helper Functions
        function showLoading(show) {
            document.getElementById('authLoading').style.display = show ? 'block' : 'none';
        }

        function showAuthMessage(message, type) {
            const messageDiv = document.getElementById('authMessage');
            messageDiv.innerHTML = `<div class="alert alert-${type}" role="alert">${message}</div>`;
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 5000);
        }

        function clearAuthMessage() {
            document.getElementById('authMessage').innerHTML = '';
        }

        function getErrorMessage(error) {
            switch (error.code) {
                case 'auth/user-not-found':
                    return 'No account found with this email address.';
                case 'auth/wrong-password':
                    return 'Incorrect password.';
                case 'auth/email-already-in-use':
                    return 'An account with this email already exists.';
                case 'auth/weak-password':
                    return 'Password should be at least 6 characters.';
                case 'auth/invalid-email':
                    return 'Invalid email address.';
                default:
                    return error.message;
            }
        }

        // Tab Navigation
        function showTab(tabName) {
            // Update nav links
            document.querySelectorAll('#mainTabs .nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Load data for specific tabs
            switch(tabName) {
                case 'matches':
                    loadMatches();
                    break;
                case 'players':
                    loadPlayers();
                    break;
                case 'tournaments':
                    loadTournaments();
                    break;
                case 'rankings':
                    loadRankings();
                    break;
            }
        }

        // Calendar Functions
        function initializeCalendar() {
            const calendarEl = document.getElementById('calendar');
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                height: 'auto',
                headerToolbar: {
                    left: 'prev,next',
                    center: 'title',
                    right: 'today'
                },
                events: [],
                eventClick: function(info) {
                    showMatchDetails(info.event.id);
                },
                dateClick: function(info) {
                    if (currentUser) {
                        showScheduleMatchModal(info.dateStr);
                    }
                }
            });
            calendar.render();
        }

        function updateCalendar(matches) {
            if (!calendar) return;
            
            const events = matches.map(match => ({
                id: match.id,
                title: `${match.player1Name} vs ${match.player2Name}`,
                start: match.date.toDate(),
                backgroundColor: getMatchStatusColor(match.status),
                borderColor: getMatchStatusColor(match.status)
            }));
            
            calendar.removeAllEvents();
            calendar.addEventSource(events);
        }

        function getMatchStatusColor(status) {
            switch(status) {
                case 'scheduled': return '#ffc107';
                case 'completed': return '#28a745';
                case 'cancelled': return '#dc3545';
                default: return '#6c757d';
            }
        }

        // Data Loading Functions
        async function loadUserData() {
            if (!currentUser) return;
            
            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    // Update UI with user data
                }
                
                const playerDoc = await db.collection('players').doc(currentUser.uid).get();
                if (playerDoc.exists) {
                    const playerData = playerDoc.data();
                    updateQuickStats(playerData);
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        async function loadMatches() {
            if (!currentUser) return;
            
            try {
                const matchesSnapshot = await db.collection('matches')
                    .orderBy('date', 'desc')
                    .limit(50)
                    .get();
                
                const matches = [];
                matchesSnapshot.forEach(doc => {
                    const matchData = doc.data();
                    // Filter matches where current user is involved
                    if (matchData.player1 === currentUser.uid || 
                        matchData.player2 === currentUser.uid ||
                        (matchData.players && matchData.players.includes(currentUser.uid))) {
                        matches.push({ id: doc.id, ...matchData });
                    }
                });
                
                updateMatchesList(matches);
                updateUpcomingMatches(matches);
                updateCalendar(matches);
            } catch (error) {
                console.error('Error loading matches:', error);
            }
        }

        async function loadPlayers() {
            try {
                const playersSnapshot = await db.collection('players')
                    .where('active', '==', true)
                    .orderBy('rating', 'desc')
                    .get();
                
                const players = [];
                playersSnapshot.forEach(doc => {
                    players.push({ id: doc.id, ...doc.data() });
                });
                
                updatePlayersTable(players);
                updateOpponentSelect(players);
            } catch (error) {
                console.error('Error loading players:', error);
            }
        }

        async function loadTournaments() {
            try {
                const tournamentsSnapshot = await db.collection('tournaments')
                    .orderBy('startDate', 'desc')
                    .get();
                
                const tournaments = [];
                tournamentsSnapshot.forEach(doc => {
                    tournaments.push({ id: doc.id, ...doc.data() });
                });
                
                updateTournamentsList(tournaments);
            } catch (error) {
                console.error('Error loading tournaments:', error);
            }
        }

        async function loadRankings() {
            try {
                const playersSnapshot = await db.collection('players')
                    .where('active', '==', true)
                    .orderBy('rating', 'desc')
                    .get();
                
                const players = [];
                playersSnapshot.forEach(doc => {
                    players.push({ id: doc.id, ...doc.data() });
                });
                
                updateRankingsTable(players);
            } catch (error) {
                console.error('Error loading rankings:', error);
            }
        }

        // UI Update Functions
        function updateQuickStats(playerData) {
            document.getElementById('totalMatches').textContent = playerData.matchesPlayed || 0;
            const winRate = playerData.matchesPlayed > 0 ? 
                Math.round((playerData.matchesWon / playerData.matchesPlayed) * 100) : 0;
            document.getElementById('winRate').textContent = winRate + '%';
            document.getElementById('currentRating').textContent = playerData.rating || 3.5;
        }

        function updateMatchesList(matches) {
            const matchesList = document.getElementById('matchesList');
            
            if (matches.length === 0) {
                matchesList.innerHTML = `
                    <div class="text-center text-muted">
                        <i class="fas fa-tennis-ball fa-2x mb-2"></i>
                        <p>No matches found</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            matches.forEach(match => {
                const matchDate = match.date ? match.date.toDate() : new Date();
                html += `
                    <div class="match-card">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="mb-1">${match.player1Name || 'Player 1'} vs ${match.player2Name || 'Player 2'}</h6>
                                <p class="mb-1 text-muted">
                                    <i class="fas fa-calendar me-1"></i>
                                    ${matchDate.toLocaleDateString()} ${matchDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                                </p>
                                <p class="mb-1 text-muted">
                                    <i class="fas fa-map-marker-alt me-1"></i>
                                    ${match.court || 'TBD'}
                                </p>
                                ${match.score ? `<p class="mb-0"><strong>Score:</strong> ${match.score}</p>` : ''}
                            </div>
                            <div class="text-end">
                                <span class="match-status status-${match.status || 'scheduled'}">${match.status || 'Scheduled'}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            matchesList.innerHTML = html;
        }

        function updateUpcomingMatches(matches) {
            const upcomingMatches = document.getElementById('upcomingMatches');
            const now = new Date();
            const upcoming = matches.filter(match => {
                const matchDate = match.date ? match.date.toDate() : new Date();
                return matchDate > now && match.status === 'scheduled';
            }).slice(0, 3);
            
            if (upcoming.length === 0) {
                upcomingMatches.innerHTML = `
                    <div class="text-center text-muted">
                        <i class="fas fa-calendar-plus fa-2x mb-2"></i>
                        <p>No upcoming matches</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            upcoming.forEach(match => {
                const matchDate = match.date.toDate();
                html += `
                    <div class="d-flex justify-content-between align-items-center mb-2 p-2 bg-light rounded">
                        <div>
                            <strong>${match.player1Name} vs ${match.player2Name}</strong>
                            <br>
                            <small class="text-muted">${matchDate.toLocaleDateString()} at ${matchDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</small>
                        </div>
                        <span class="badge bg-warning">${match.court}</span>
                    </div>
                `;
            });
            
            upcomingMatches.innerHTML = html;
        }

        function updatePlayersTable(players) {
            const tbody = document.getElementById('playersTableBody');
            
            if (players.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center text-muted">
                            <i class="fas fa-users fa-2x mb-2"></i>
                            <br>No players found
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            players.forEach(player => {
                const winRate = player.matchesPlayed > 0 ? 
                    Math.round((player.matchesWon / player.matchesPlayed) * 100) : 0;
                
                html += `
                    <tr>
                        <td>
                            <strong>${player.name}</strong>
                            <br>
                            <small class="text-muted">${player.email}</small>
                        </td>
                        <td><span class="badge bg-primary">${player.rating}</span></td>
                        <td>${player.matchesPlayed || 0}</td>
                        <td>${winRate}%</td>
                        <td>
                            ${player.id !== currentUser.uid ? `
                                <button class="btn btn-sm btn-outline-primary" onclick="challengePlayer('${player.id}')">
                                    <i class="fas fa-handshake me-1"></i>Challenge
                                </button>
                            ` : '<span class="text-muted">You</span>'}
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        function updateOpponentSelect(players) {
            const select = document.getElementById('opponentSelect');
            select.innerHTML = '<option value="">Select opponent...</option>';
            
            players.forEach(player => {
                if (player.id !== currentUser.uid) {
                    select.innerHTML += `<option value="${player.id}">${player.name} (${player.rating})</option>`;
                }
            });
        }

        function updateTournamentsList(tournaments) {
            const tournamentsList = document.getElementById('tournamentsList');
            
            if (tournaments.length === 0) {
                tournamentsList.innerHTML = `
                    <div class="col-12 text-center text-muted">
                        <i class="fas fa-trophy fa-2x mb-2"></i>
                        <p>No tournaments available</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            tournaments.forEach(tournament => {
                const startDate = tournament.startDate ? tournament.startDate.toDate() : new Date();
                html += `
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">
                                    <i class="fas fa-trophy me-2 text-warning"></i>
                                    ${tournament.name}
                                </h5>
                                <p class="card-text">${tournament.description || 'Tournament details coming soon...'}</p>
                                <p class="text-muted">
                                    <i class="fas fa-calendar me-1"></i>
                                    ${startDate.toLocaleDateString()}
                                </p>
                                <button class="btn btn-primary btn-sm">
                                    <i class="fas fa-info-circle me-1"></i>
                                    View Details
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            tournamentsList.innerHTML = html;
        }

        function updateRankingsTable(players) {
            const tbody = document.getElementById('rankingsTableBody');
            
            if (players.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center text-muted">
                            <i class="fas fa-chart-line fa-2x mb-2"></i>
                            <br>No rankings available
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            players.forEach((player, index) => {
                const winRate = player.matchesPlayed > 0 ? 
                    Math.round((player.matchesWon / player.matchesPlayed) * 100) : 0;
                const points = Math.round(player.rating * 100 + (player.matchesWon * 10));
                
                html += `
                    <tr ${player.id === currentUser.uid ? 'class="table-warning"' : ''}>
                        <td>
                            <strong>#${index + 1}</strong>
                            ${index < 3 ? `<i class="fas fa-medal text-warning ms-1"></i>` : ''}
                        </td>
                        <td>
                            <strong>${player.name}</strong>
                            ${player.id === currentUser.uid ? '<span class="badge bg-primary ms-2">You</span>' : ''}
                        </td>
                        <td><span class="badge bg-primary">${player.rating}</span></td>
                        <td>${player.matchesPlayed || 0}</td>
                        <td>${winRate}%</td>
                        <td>${points}</td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        // Match Functions
        function showScheduleMatchModal(dateStr = null) {
            if (dateStr) {
                const date = new Date(dateStr + 'T10:00');
                document.getElementById('matchDate').value = date.toISOString().slice(0, 16);
            }
            
            const modal = new bootstrap.Modal(document.getElementById('scheduleMatchModal'));
            modal.show();
        }

        async function scheduleMatch() {
            const opponentId = document.getElementById('opponentSelect').value;
            const matchDate = document.getElementById('matchDate').value;
            const court = document.getElementById('courtSelect').value;
            const notes = document.getElementById('matchNotes').value;
            
            if (!opponentId || !matchDate || !court) {
                alert('Please fill in all required fields');
                return;
            }
            
            try {
                // Get opponent data
                const opponentDoc = await db.collection('players').doc(opponentId).get();
                const opponentData = opponentDoc.data();
                
                // Get current user data
                const currentUserDoc = await db.collection('players').doc(currentUser.uid).get();
                const currentUserData = currentUserDoc.data();
                
                // Create match
                await db.collection('matches').add({
                    player1: currentUser.uid,
                    player2: opponentId,
                    player1Name: currentUserData.name,
                    player2Name: opponentData.name,
                    players: [currentUser.uid, opponentId],
                    date: firebase.firestore.Timestamp.fromDate(new Date(matchDate)),
                    court: court,
                    status: 'scheduled',
                    notes: notes,
                    createdBy: currentUser.uid,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Close modal and refresh data
                bootstrap.Modal.getInstance(document.getElementById('scheduleMatchModal')).hide();
                document.getElementById('scheduleMatchForm').reset();
                
                // Reload matches
                loadMatches();
                
                alert('Match scheduled successfully!');
            } catch (error) {
                console.error('Error scheduling match:', error);
                alert('Error scheduling match. Please try again.');
            }
        }

        function challengePlayer(playerId) {
            document.getElementById('opponentSelect').value = playerId;
            showScheduleMatchModal();
        }

        // Search Functions
        function searchPlayers() {
            const searchTerm = document.getElementById('playerSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#playersTableBody tr');
            
            rows.forEach(row => {
                const playerName = row.querySelector('td:first-child strong')?.textContent.toLowerCase();
                if (playerName && playerName.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // Profile Functions
        function showProfile() {
            alert('Profile functionality coming soon!');
        }

        // Placeholder functions for future implementation
        function showMatchDetails(matchId) {
            alert('Match details functionality coming soon!');
        }
    </script>
</body>
</html>